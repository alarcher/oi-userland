#
# This file and its contents are supplied under the terms of the
# Common Development and Distribution License ("CDDL"). You may
# only use this file in accordance with the terms of the CDDL.
#
# A full copy of the text of the CDDL should have accompanied this
# source. A copy of the CDDL is also available via the Internet at
# http://www.illumos.org/license/CDDL.
#

#
# Copyright 2016 Aurelien Larcher
#

include ../../../make-rules/shared-macros.mk
include $(WS_MAKE_RULES)/x11.mk

COMPONENT_NAME= xorg-core-fonts
COMPONENT_VERSION= 7.7
COMPONENT_SUMMARY= X Window System bitmap & scalable font from the X.Org Foundation
COMPONENT_PROJECT_URL= $(XORG_PROJECT_URL)
COMPONENT_FMRI= system/font/xorg/xorg-core
COMPONENT_CLASSIFICATION= System/Fonts
COMPONENT_LICENSE= MIT

XORG_FONTS_BASE_URL= https://www.x.org/releases/individual/font/

#
# Delivering only xorg-core fonts
#

FONT_NAME_1 = adobe-utopia-type1
FONT_VERSION_1 = 1.0.4
COMPONENT_SRC_1 = font-$(FONT_NAME_1)-$(FONT_VERSION_1)
COMPONENT_ARCHIVE_1 = $(COMPONENT_SRC_1).tar.gz
COMPONENT_ARCHIVE_URL_1 = $(XORG_FONTS_BASE_URL)$(COMPONENT_ARCHIVE_1)
COMPONENT_ARCHIVE_HASH_1 = \
    sha256:d9e86a8805b0fb78222409169d839a8531a1f5c7284ee117ff2a0af2e5016c3f

FONT_NAME_2 = alias
FONT_VERSION_2 = 1.0.3
COMPONENT_SRC_2 = font-$(FONT_NAME_2)-$(FONT_VERSION_2)
COMPONENT_ARCHIVE_2 = $(COMPONENT_SRC_2).tar.gz
COMPONENT_ARCHIVE_URL_2 = $(XORG_FONTS_BASE_URL)$(COMPONENT_ARCHIVE_2)
COMPONENT_ARCHIVE_HASH_2 = \
    sha256:63087cb61d17bfc9cd6f4f9359f63a3b1dd83300a31a42fd93dca084724c6afb

FONT_NAME_3 = arabic-misc
FONT_VERSION_3 = 1.0.3
COMPONENT_SRC_3 = font-$(FONT_NAME_3)-$(FONT_VERSION_3)
COMPONENT_ARCHIVE_3 = $(COMPONENT_SRC_3).tar.gz
COMPONENT_ARCHIVE_URL_3 = $(XORG_FONTS_BASE_URL)$(COMPONENT_ARCHIVE_3)
COMPONENT_ARCHIVE_HASH_3 = \
    sha256:3022b6b124f4cc6aade961f8d1306f67ff42e3b7922fb2244847f287344aefea

FONT_NAME_4 = bh-type1
FONT_VERSION_4 = 1.0.3
COMPONENT_SRC_4 = font-$(FONT_NAME_4)-$(FONT_VERSION_4)
COMPONENT_ARCHIVE_4 = $(COMPONENT_SRC_4).tar.gz
COMPONENT_ARCHIVE_URL_4 = $(XORG_FONTS_BASE_URL)$(COMPONENT_ARCHIVE_4)
COMPONENT_ARCHIVE_HASH_4 = \
    sha256:d5602f1d749ccd31d3bc1bb6f0c5d77400de0e5e3ac5abebd2a867aa2a4081a4

FONT_NAME_5 = bitstream-100dpi
FONT_VERSION_5 = 1.0.3
COMPONENT_SRC_5 = font-$(FONT_NAME_5)-$(FONT_VERSION_5)
COMPONENT_ARCHIVE_5 = $(COMPONENT_SRC_5).tar.gz
COMPONENT_ARCHIVE_URL_5 = $(XORG_FONTS_BASE_URL)$(COMPONENT_ARCHIVE_5)
COMPONENT_ARCHIVE_HASH_5 = \
    sha256:0a8c77c1540dc376fb2bb5a02bd33ee5f3563fbac9fc07c7947cac462c4bb48a

FONT_NAME_6 = bitstream-75dpi
FONT_VERSION_6 = 1.0.3
COMPONENT_SRC_6 = font-$(FONT_NAME_6)-$(FONT_VERSION_6)
COMPONENT_ARCHIVE_6 = $(COMPONENT_SRC_6).tar.gz
COMPONENT_ARCHIVE_URL_6 = $(XORG_FONTS_BASE_URL)$(COMPONENT_ARCHIVE_6)
COMPONENT_ARCHIVE_HASH_6 = \
    sha256:c43ae370932eb8a4789a5b1f9801da15228b0d4c803251785c38d82aef024a4b

FONT_NAME_7 = bitstream-type1
FONT_VERSION_7 = 1.0.3
COMPONENT_SRC_7 = font-$(FONT_NAME_7)-$(FONT_VERSION_7)
COMPONENT_ARCHIVE_7 = $(COMPONENT_SRC_7).tar.gz
COMPONENT_ARCHIVE_URL_7 = $(XORG_FONTS_BASE_URL)$(COMPONENT_ARCHIVE_7)
COMPONENT_ARCHIVE_HASH_7 = \
    sha256:3399b7586c18be509cdaeceeebf754b861faa1d8799dda1aae01aeb2a7a30f01

FONT_NAME_8 = cursor-misc
FONT_VERSION_8 = 1.0.3
COMPONENT_SRC_8 = font-$(FONT_NAME_8)-$(FONT_VERSION_8)
COMPONENT_ARCHIVE_8 = $(COMPONENT_SRC_8).tar.gz
COMPONENT_ARCHIVE_URL_8 = $(XORG_FONTS_BASE_URL)$(COMPONENT_ARCHIVE_8)
COMPONENT_ARCHIVE_HASH_8 = \
    sha256:a0b146139363dd0a704c7265ff9cd9150d4ae7c0d248091a9a42093e1618c427

FONT_NAME_9 = dec-misc
FONT_VERSION_9 = 1.0.3
COMPONENT_SRC_9 = font-$(FONT_NAME_9)-$(FONT_VERSION_9)
COMPONENT_ARCHIVE_9 = $(COMPONENT_SRC_9).tar.gz
COMPONENT_ARCHIVE_URL_9 = $(XORG_FONTS_BASE_URL)$(COMPONENT_ARCHIVE_9)
COMPONENT_ARCHIVE_HASH_9 = \
    sha256:c4923342f6068c83fd4f5dbcf60d671c28461300db7e2aee930c8634b1e4b74a

FONT_NAME_10= ibm-type1
FONT_VERSION_10= 1.0.3
COMPONENT_SRC_10= font-$(FONT_NAME_10)-$(FONT_VERSION_10)
COMPONENT_ARCHIVE_10 = $(COMPONENT_SRC_10).tar.gz
COMPONENT_ARCHIVE_URL_10 = $(XORG_FONTS_BASE_URL)$(COMPONENT_ARCHIVE_10)
COMPONENT_ARCHIVE_HASH_10 = \
    sha256:4509703e9e581061309cf4823bffd4a93f10f48fe192a1d8be1f183fd6ab9711

FONT_NAME_11= micro-misc
FONT_VERSION_11= 1.0.3
COMPONENT_SRC_11= font-$(FONT_NAME_11)-$(FONT_VERSION_11)
COMPONENT_ARCHIVE_11 = $(COMPONENT_SRC_11).tar.gz
COMPONENT_ARCHIVE_URL_11 = $(XORG_FONTS_BASE_URL)$(COMPONENT_ARCHIVE_11)
COMPONENT_ARCHIVE_HASH_11 = \
    sha256:97ee77a9d8ca3e7caf0c78c386eb0b96e8a825ca3642ec035cfb83f5f2cf1475

FONT_NAME_12= mutt-misc
FONT_VERSION_12= 1.0.3
COMPONENT_SRC_12= font-$(FONT_NAME_12)-$(FONT_VERSION_12)
COMPONENT_ARCHIVE_12 = $(COMPONENT_SRC_12).tar.gz
COMPONENT_ARCHIVE_URL_12 = $(XORG_FONTS_BASE_URL)$(COMPONENT_ARCHIVE_12)
COMPONENT_ARCHIVE_HASH_12 = \
    sha256:fcecbfc475dfe5826d137f8edc623ba27d58d32f069165c248a013b3c566bb59

FONT_NAME_13= sony-misc
FONT_VERSION_13= 1.0.3
COMPONENT_SRC_13= font-$(FONT_NAME_13)-$(FONT_VERSION_13)
COMPONENT_ARCHIVE_13 = $(COMPONENT_SRC_13).tar.gz
COMPONENT_ARCHIVE_URL_13 = $(XORG_FONTS_BASE_URL)$(COMPONENT_ARCHIVE_13)
COMPONENT_ARCHIVE_HASH_13 = \
    sha256:7afd758a3c25ee48458d5f876ef22d7a521d40e13ffe577d88d308b45b3c041b

FONT_NAME_14= sun-misc
FONT_VERSION_14= 1.0.3
COMPONENT_SRC_14= font-$(FONT_NAME_14)-$(FONT_VERSION_14)
COMPONENT_ARCHIVE_14 = $(COMPONENT_SRC_14).tar.gz
COMPONENT_ARCHIVE_URL_14 = $(XORG_FONTS_BASE_URL)$(COMPONENT_ARCHIVE_14)
COMPONENT_ARCHIVE_HASH_14 = \
    sha256:549c6ba59979da25e85c218a26e5c527c3c24ebab2c76509c1ebc34d94fae227

FONT_NAME_15= xfree86-type1
FONT_VERSION_15= 1.0.4
COMPONENT_SRC_15= font-$(FONT_NAME_15)-$(FONT_VERSION_15)
COMPONENT_ARCHIVE_15 = $(COMPONENT_SRC_15).tar.gz
COMPONENT_ARCHIVE_URL_15 = $(XORG_FONTS_BASE_URL)$(COMPONENT_ARCHIVE_15)
COMPONENT_ARCHIVE_HASH_15 = \
    sha256:02b3839ae79ba6a7750525bb3b0c281305664b95bf63b4a0baa230a277b4f928

#
# Delivering xorg-core fonts and ISO8859 fonts
#

FONT_ENC_16=100dpi
FONT_NAME_16= adobe-100dpi
FONT_VERSION_16= 1.0.3
COMPONENT_SRC_16= font-$(FONT_NAME_16)-$(FONT_VERSION_16)
COMPONENT_ARCHIVE_16 = $(COMPONENT_SRC_16).tar.gz
COMPONENT_ARCHIVE_URL_16 = $(XORG_FONTS_BASE_URL)$(COMPONENT_ARCHIVE_16)
COMPONENT_ARCHIVE_HASH_16 = \
    sha256:97d9c1e706938838e4134d74f0836ae9d9ca6705ecb405c9a0ac8fdcbd9c2159

FONT_ENC_17=75dpi
FONT_NAME_17= adobe-75dpi
FONT_VERSION_17= 1.0.3
COMPONENT_SRC_17= font-$(FONT_NAME_17)-$(FONT_VERSION_17)
COMPONENT_ARCHIVE_17 = $(COMPONENT_SRC_17).tar.gz
COMPONENT_ARCHIVE_URL_17 = $(XORG_FONTS_BASE_URL)$(COMPONENT_ARCHIVE_17)
COMPONENT_ARCHIVE_HASH_17 = \
    sha256:61eb1fcfec89f7435cb92cd68712fbe4ba412ca562b1f5feec1f6daa1b8544f6

FONT_ENC_18=100dpi
FONT_NAME_18= adobe-utopia-100dpi
FONT_VERSION_18= 1.0.4
COMPONENT_SRC_18= font-$(FONT_NAME_18)-$(FONT_VERSION_18)
COMPONENT_ARCHIVE_18 = $(COMPONENT_SRC_18).tar.gz
COMPONENT_ARCHIVE_URL_18 = $(XORG_FONTS_BASE_URL)$(COMPONENT_ARCHIVE_18)
COMPONENT_ARCHIVE_HASH_18 = \
    sha256:e8c3417d89183b1fc383fb3e0f3948c0d01fabcb9edace8b7ec85eab8cdc18c4

FONT_ENC_19=75dpi
FONT_NAME_19= adobe-utopia-75dpi
FONT_VERSION_19= 1.0.4
COMPONENT_SRC_19= font-$(FONT_NAME_19)-$(FONT_VERSION_19)
COMPONENT_ARCHIVE_19 = $(COMPONENT_SRC_19).tar.gz
COMPONENT_ARCHIVE_URL_19 = $(XORG_FONTS_BASE_URL)$(COMPONENT_ARCHIVE_19)
COMPONENT_ARCHIVE_HASH_19 = \
    sha256:254be39c09da1c4e77d2a75a2969330ee2db395120a428671c50aef3ab745fc0

FONT_ENC_20=100dpi
FONT_NAME_20= bh-100dpi
FONT_VERSION_20= 1.0.3
COMPONENT_SRC_20= font-$(FONT_NAME_20)-$(FONT_VERSION_20)
COMPONENT_ARCHIVE_20 = $(COMPONENT_SRC_20).tar.gz
COMPONENT_ARCHIVE_URL_20 = $(XORG_FONTS_BASE_URL)$(COMPONENT_ARCHIVE_20)
COMPONENT_ARCHIVE_HASH_20 = \
    sha256:817703372f080d6508cf109011b17f3572ff31047559fe82d93b487ca4e4e2d9

FONT_ENC_21=75dpi
FONT_NAME_21= bh-75dpi
FONT_VERSION_21= 1.0.3
COMPONENT_SRC_21= font-$(FONT_NAME_21)-$(FONT_VERSION_21)
COMPONENT_ARCHIVE_21 = $(COMPONENT_SRC_21).tar.gz
COMPONENT_ARCHIVE_URL_21 = $(XORG_FONTS_BASE_URL)$(COMPONENT_ARCHIVE_21)
COMPONENT_ARCHIVE_HASH_21 = \
    sha256:720b6a513894bfc09a163951ec3dd8311201e08ee40e8891547b6c129ffb5fce

FONT_ENC_22=100dpi
FONT_NAME_22= bh-lucidatypewriter-100dpi
FONT_VERSION_22= 1.0.3
COMPONENT_SRC_22= font-$(FONT_NAME_22)-$(FONT_VERSION_22)
COMPONENT_ARCHIVE_22 = $(COMPONENT_SRC_22).tar.gz
COMPONENT_ARCHIVE_URL_22 = $(XORG_FONTS_BASE_URL)$(COMPONENT_ARCHIVE_22)
COMPONENT_ARCHIVE_HASH_22 = \
    sha256:5e05a642182ec6a77bd7cacb913d3c86b364429329a5f223b69792d418f90ae9

FONT_ENC_23=75dpi
FONT_NAME_23= bh-lucidatypewriter-75dpi
FONT_VERSION_23= 1.0.3
COMPONENT_SRC_23= font-$(FONT_NAME_23)-$(FONT_VERSION_23)
COMPONENT_ARCHIVE_23 = $(COMPONENT_SRC_23).tar.gz
COMPONENT_ARCHIVE_URL_23 = $(XORG_FONTS_BASE_URL)$(COMPONENT_ARCHIVE_23)
COMPONENT_ARCHIVE_HASH_23 = \
    sha256:38301bbdb6374494f30c0b44acc7052ed8fc2289e917e648ca566fc591f0a9e0

FONT_ENC_24=100dpi
FONT_NAME_24= bitstream-100dpi
FONT_VERSION_24= 1.0.3
COMPONENT_SRC_24= font-$(FONT_NAME_24)-$(FONT_VERSION_24)
COMPONENT_ARCHIVE_24 = $(COMPONENT_SRC_24).tar.gz
COMPONENT_ARCHIVE_URL_24 = $(XORG_FONTS_BASE_URL)$(COMPONENT_ARCHIVE_24)
COMPONENT_ARCHIVE_HASH_24 = \
    sha256:254be39c09da1c4e77d2a75a2969330ee2db395120a428671c50aef3ab745fc0

FONT_ENC_25=75dpi
FONT_NAME_25= bitstream-75dpi
FONT_VERSION_25= 1.0.3
COMPONENT_SRC_25= font-$(FONT_NAME_25)-$(FONT_VERSION_25)
COMPONENT_ARCHIVE_25 = $(COMPONENT_SRC_25).tar.gz
COMPONENT_ARCHIVE_URL_25 = $(XORG_FONTS_BASE_URL)$(COMPONENT_ARCHIVE_25)
COMPONENT_ARCHIVE_HASH_25 = \
    sha256:c43ae370932eb8a4789a5b1f9801da15228b0d4c803251785c38d82aef024a4b

#
# Miscellaneous fonts
#

FONT_ENC_16=misc
FONT_NAME_26= misc-misc
FONT_VERSION_26= 1.1.2
COMPONENT_SRC_26= font-$(FONT_NAME_26)-$(FONT_VERSION_26)
COMPONENT_ARCHIVE_26 = $(COMPONENT_SRC_26).tar.gz
COMPONENT_ARCHIVE_URL_26 = $(XORG_FONTS_BASE_URL)$(COMPONENT_ARCHIVE_26)
COMPONENT_ARCHIVE_HASH_26 = \
    sha256:46142c876e176036c61c0c24c0a689079704d5ca5b510d48c025861ee2dbf829

FONT_ENC_16=misc
FONT_NAME_27= schumacher-misc
FONT_VERSION_27= 1.1.2
COMPONENT_SRC_27= font-$(FONT_NAME_27)-$(FONT_VERSION_27)
COMPONENT_ARCHIVE_27 = $(COMPONENT_SRC_27).tar.gz
COMPONENT_ARCHIVE_URL_27 = $(XORG_FONTS_BASE_URL)$(COMPONENT_ARCHIVE_27)
COMPONENT_ARCHIVE_HASH_27 = \
    sha256:dc3b8d5890480943e735e0375f0e0d8333094fcb6d6845ba321b2e39db78d148

include $(WS_MAKE_RULES)/prep.mk
include $(WS_MAKE_RULES)/configure.mk
include $(WS_MAKE_RULES)/ips.mk

#
# Common configuration flags
#

core_ENCODINGS = core

all_ENCODINGS = \
    iso8859-1   \
    iso8859-2   \
    iso8859-3   \
    iso8859-4   \
    iso8859-9   \
    iso8859-10  \
    iso8859-13  \
    iso8859-14  \
    iso8859-15

100dpi_ENCODINGS = $(all_ENCODINGS)

75dpi_ENCODINGS = $(all_ENCODINGS)

misc_ENCODINGS = $(all_ENCODINGS) \
    iso8859-5    \
    iso8859-7    \
    iso8859-8    \
    iso8859-11   \
    iso8859-16

XORGFONTSDIR=$(USRSHAREDIR)/fonts/X11
CONFIGURE_OPTIONS+= --with-fontrootdir=$(XORGFONTSDIR)
CONFIGURE_OPTIONS+= --without-compression

FONT_SUFFIXES = $(subst FONT_NAME_,, \
                $(filter FONT_NAME_%, $(.VARIABLES)))

#
# Define rules for each font
#

define font-rules

# Define the font as core by default
FONT_ENC$(1)?=core

SOURCE_DIR$(1)       = $$(COMPONENT_DIR)/$$(COMPONENT_SRC$(1))
BUILD_DIR$(1)        = $$(BUILD_DIR)/$$(COMPONENT_SRC$(1))

BUILD_STAMP$(1)      = $$(BUILD_DIR$(1))/.built
CONFIGURE_SCRIPT$(1) = $$(SOURCE_DIR$(1))/configure

$$(BUILD_STAMP$(1)):	$(SOURCE_DIR)/.prep
	($$(RM) -rf $$(@D) ; $$(MKDIR) $$(@D))
	for enc in $$($$(FONT_ENC$(1))_ENCODINGS); \
	do \
		$(MKDIR) $$(@D)/$$$$enc; \
		echo "BUILD ENCODING $$$$enc"; \
		(cd $$(@D)/$$$$enc ; \
			$$(ENV) $$(CONFIGURE_ENV) $$(CONFIG_SHELL) \
				$$(CONFIGURE_SCRIPT$(1)) $$(CONFIGURE_OPTIONS) \
				$$(if $$(filter-out $$(FONT_ENC$(1)),core), --disable-all-encodings --enable-$$$$enc --with-fontdir=$$(XORGFONTSDIR)/$$(FONT_ENC$(1))-$$$${enc^^}) \
		    && \
			$$(GMAKE) $$(COMPONENT_BUILD_GMAKE_ARGS) $$(COMPONENT_BUILD_ARGS) \
				$$(COMPONENT_BUILD_TARGETS)); \
	done;
	$$(TOUCH) $$@

INSTALL_STAMP$(1)    = $$(BUILD_DIR$(1))/.installed

$$(INSTALL_STAMP$(1)):	$$(BUILD_STAMP$(1))
	for enc in $$($$(FONT_ENC$(1))_ENCODINGS); \
	do \
	(cd $$(@D)/$$$$enc ; \
		$$(ENV) $$(COMPONENT_INSTALL_ENV) $$(GMAKE) \
			$$(COMPONENT_INSTALL_ARGS) $$(COMPONENT_INSTALL_TARGETS)); \
	done;
	$$(TOUCH) $$@

endef

$(foreach suffix, $(FONT_SUFFIXES), $(eval $(call font-rules,_$(suffix))))

#
# Build target
#

FONT_BUILD_REQS:= $(foreach suffix, $(FONT_SUFFIXES), $(BUILD_STAMP_$(suffix)))

define build-rule

build:	$(FONT_BUILD_REQS)

endef

$(eval $(build-rule))

#
# Install target
#

FONT_INSTALL_REQS:= $(foreach suffix, $(FONT_SUFFIXES), $(INSTALL_STAMP_$(suffix)))

install:	$(FONT_INSTALL_REQS)

$(eval $(install-rule))

#

test:		$(NO_TESTS)
